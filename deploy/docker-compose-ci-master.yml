version: "3.6"
services:
  cypress:
    image: $DEPLOY_REGISTRY/cucb/website:latest
    volumes:
      - app:/usr/src/app
      - ./static:/usr/src/app/static
      - ./wait-for-it.sh:/usr/src/app/wait-for-it.sh
    command: >
      bash -c "npx cypress install; chmod a+x wait-for-it.sh; ./wait-for-it.sh graphql-engine:8080 -t 180 -- npm run test:ci:prod"

volumes:
  app:
