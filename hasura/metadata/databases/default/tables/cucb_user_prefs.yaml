table:
  name: user_prefs
  schema: cucb
object_relationships:
  - name: pref_type
    using:
      foreign_key_constraint_on: pref_id
  - name: user
    using:
      foreign_key_constraint_on: user_id
insert_permissions:
  - role: current_user
    permission:
      check: {}
      set:
        user_id: x-hasura-User-Id
      columns:
        - pref_id
        - value
  - role: equipment
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
  - role: gig_editor
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
  - role: president
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
  - role: secretary
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
  - role: treasurer
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
  - role: webmaster
    permission:
      check:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      columns:
        - pref_id
        - user_id
        - value
select_permissions:
  - role: current_user
    permission:
      columns:
        - value
        - pref_id
        - user_id
      filter:
        user_id:
          _eq: X-Hasura-User-Id
  - role: equipment
    permission:
      columns:
        - pref_id
        - user_id
        - value
      filter:
        pref_type:
          name:
            _like: attribute.%
  - role: gig_editor
    permission:
      columns:
        - pref_id
        - user_id
        - value
      filter:
        pref_type:
          name:
            _like: attribute.%
  - role: president
    permission:
      columns:
        - pref_id
        - user_id
        - value
      filter:
        pref_type:
          name:
            _like: attribute.%
  - role: secretary
    permission:
      columns:
        - pref_id
        - user_id
        - value
      filter:
        pref_type:
          name:
            _like: attribute.%
  - role: treasurer
    permission:
      columns:
        - pref_id
        - user_id
        - value
      filter:
        pref_type:
          name:
            _like: attribute.%
  - role: webmaster
    permission:
      columns:
        - user_id
        - pref_id
        - value
      filter: {}
update_permissions:
  - role: current_user
    permission:
      columns:
        - value
      filter:
        user_id:
          _eq: X-Hasura-User-Id
      check: null
  - role: equipment
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
  - role: gig_editor
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
  - role: president
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
  - role: secretary
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
  - role: treasurer
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
  - role: webmaster
    permission:
      columns:
        - value
      filter:
        _and:
          - pref_type:
              name:
                _like: attribute.%
          - user_id:
              _ne: X-Hasura-User-Id
      check: {}
