version: 2
tables:
  - table:
      schema: cucb
      name: auth_action_types
  - table:
      schema: cucb
      name: auth_bitmasks_permissions
  - table:
      schema: cucb
      name: auth_user_types
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - title
            - php_title
            - hasura_role
          filter: {}
  - table:
      schema: cucb
      name: biscuit_poll_entries
  - table:
      schema: cucb
      name: biscuit_poll_votes
  - table:
      schema: cucb
      name: biscuit_polls
  - table:
      schema: cucb
      name: calendar_subscriptions
  - table:
      schema: cucb
      name: captions
  - table:
      schema: cucb
      name: committee_keys
  - table:
      schema: cucb
      name: committee_members
  - table:
      schema: cucb
      name: committee_positions
  - table:
      schema: cucb
      name: committees
  - table:
      schema: cucb
      name: connection_types
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - name
            - icon_name
          filter: {}
      - role: user
        permission:
          columns:
            - id
            - icon_name
            - name
          filter: {}
      - role: webmaster
        permission:
          columns:
            - id
            - name
            - icon_name
          filter: {}
  - table:
      schema: cucb
      name: contacts
  - table:
      schema: cucb
      name: galleries
  - table:
      schema: cucb
      name: gig_types
  - table:
      schema: cucb
      name: gig_venues
    insert_permissions:
      - role: secretary
        permission:
          check: {}
          columns:
            - address
            - distance_miles
            - latitude
            - longitude
            - map_link
            - name
            - notes_admin
            - notes_band
            - postcode
            - subvenue
      - role: webmaster
        permission:
          check: {}
          columns:
            - address
            - distance_miles
            - latitude
            - longitude
            - map_link
            - name
            - notes_admin
            - notes_band
            - postcode
            - subvenue
    select_permissions:
      - role: secretary
        permission:
          columns:
            - latitude
            - longitude
            - distance_miles
            - id
            - notes_admin
            - notes_band
            - address
            - map_link
            - name
            - postcode
            - subvenue
          filter: {}
      - role: user
        permission:
          columns:
            - address
            - distance_miles
            - id
            - latitude
            - longitude
            - map_link
            - name
            - notes_band
            - postcode
            - subvenue
          filter: {}
      - role: webmaster
        permission:
          columns:
            - latitude
            - longitude
            - distance_miles
            - id
            - notes_admin
            - notes_band
            - address
            - map_link
            - name
            - postcode
            - subvenue
          filter: {}
    update_permissions:
      - role: secretary
        permission:
          columns:
            - address
            - distance_miles
            - latitude
            - longitude
            - map_link
            - name
            - notes_admin
            - notes_band
            - postcode
            - subvenue
          filter: {}
      - role: webmaster
        permission:
          columns:
            - address
            - distance_miles
            - latitude
            - longitude
            - map_link
            - name
            - notes_admin
            - notes_band
            - postcode
            - subvenue
          filter: {}
    delete_permissions:
      - role: secretary
        permission:
          filter: {}
      - role: webmaster
        permission:
          filter: {}
  - table:
      schema: cucb
      name: gigs
    object_relationships:
      - name: gig_type
        using:
          foreign_key_constraint_on: type
      - name: user
        using:
          foreign_key_constraint_on: posting_user
      - name: venue
        using:
          foreign_key_constraint_on: venue_id
    array_relationships:
      - name: contacts
        using:
          foreign_key_constraint_on:
            column: gig_id
            table:
              schema: cucb
              name: gigs_contacts
      - name: lineup
        using:
          foreign_key_constraint_on:
            column: gig_id
            table:
              schema: cucb
              name: gigs_lineups
    insert_permissions:
      - role: secretary
        permission:
          check: {}
          set:
            posting_user: x-hasura-User-Id
            editing_user: x-hasura-User-Id
          columns:
            - admins_only
            - advertise
            - allow_signups
            - arrive_time
            - date
            - finance
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - finish_time
            - notes_admin
            - notes_band
            - quote_date
            - summary
            - time
            - title
            - type
            - venue_id
      - role: webmaster
        permission:
          check: {}
          set:
            posting_user: x-hasura-User-Id
            editing_user: x-hasura-User-Id
          columns:
            - admins_only
            - advertise
            - allow_signups
            - arrive_time
            - date
            - finance
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - finish_time
            - notes_admin
            - notes_band
            - quote_date
            - summary
            - time
            - title
            - type
            - venue_id
    select_permissions:
      - role: secretary
        permission:
          columns:
            - admins_only
            - advertise
            - allow_signups
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - date
            - quote_date
            - editing_user
            - id
            - posting_user
            - type
            - venue_id
            - finance
            - notes_admin
            - notes_band
            - summary
            - time
            - arrive_time
            - editing_time
            - finish_time
            - posting_time
            - title
          filter: {}
      - role: user
        permission:
          columns:
            - allow_signups
            - arrive_time
            - date
            - finish_time
            - id
            - notes_band
            - summary
            - time
            - title
            - type
            - venue_id
          filter:
            admins_only:
              _eq: false
      - role: webmaster
        permission:
          columns:
            - admins_only
            - advertise
            - allow_signups
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - date
            - quote_date
            - editing_user
            - id
            - posting_user
            - type
            - venue_id
            - finance
            - notes_admin
            - notes_band
            - summary
            - time
            - arrive_time
            - editing_time
            - finish_time
            - posting_time
            - title
          filter: {}
    update_permissions:
      - role: secretary
        permission:
          columns:
            - admins_only
            - advertise
            - allow_signups
            - arrive_time
            - date
            - finance
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - finish_time
            - notes_admin
            - notes_band
            - quote_date
            - summary
            - time
            - title
            - type
            - venue_id
          filter: {}
          set:
            editing_user: x-hasura-User-Id
      - role: webmaster
        permission:
          columns:
            - admins_only
            - advertise
            - allow_signups
            - arrive_time
            - date
            - finance
            - finance_caller_paid
            - finance_deposit_received
            - finance_payment_received
            - finish_time
            - notes_admin
            - notes_band
            - quote_date
            - summary
            - time
            - title
            - type
            - venue_id
          filter: {}
          set:
            editing_user: x-hasura-User-Id
    delete_permissions:
      - role: secretary
        permission:
          filter: {}
      - role: webmaster
        permission:
          filter: {}
  - table:
      schema: cucb
      name: gigs_contacts
  - table:
      schema: cucb
      name: gigs_lineups
    object_relationships:
      - name: user
        using:
          foreign_key_constraint_on: user_id
    array_relationships:
      - name: user_instruments
        using:
          manual_configuration:
            remote_table:
              schema: cucb
              name: gigs_lineups_instruments
            column_mapping:
              user_id: user_id
              gig_id: gig_id
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - gig_id
            - user_id
            - adding_time
            - editing_time
            - approved
            - equipment
            - leader
            - driver
            - money_collector
            - money_collector_notified
            - user_notes
            - user_available
            - user_only_if_necessary
            - admin_notes
          filter: {}
      - role: webmaster
        permission:
          columns:
            - id
            - gig_id
            - user_id
            - adding_time
            - editing_time
            - approved
            - equipment
            - leader
            - driver
            - money_collector
            - money_collector_notified
            - user_notes
            - user_available
            - user_only_if_necessary
            - admin_notes
          filter: {}
    update_permissions:
      - role: webmaster
        permission:
          columns:
            - admin_notes
            - approved
            - driver
            - equipment
            - leader
            - money_collector
            - money_collector_notified
            - user_available
            - user_notes
            - user_only_if_necessary
          filter: {}
  - table:
      schema: cucb
      name: gigs_lineups_instruments
    object_relationships:
      - name: user_instrument
        using:
          foreign_key_constraint_on: user_instrument_id
    insert_permissions:
      - role: secretary
        permission:
          check: {}
          set:
            user_id: x-hasura-User-Id
          columns:
            - approved
            - gig_id
            - user_id
            - user_instrument_id
      - role: user
        permission:
          check: {}
          set:
            user_id: x-hasura-User-Id
          columns:
            - gig_id
            - user_instrument_id
      - role: webmaster
        permission:
          check: {}
          set:
            user_id: x-hasura-User-Id
          columns:
            - approved
            - gig_id
            - user_id
            - user_instrument_id
    select_permissions:
      - role: secretary
        permission:
          columns:
            - approved
            - gig_id
            - user_id
            - user_instrument_id
          filter: {}
      - role: user
        permission:
          columns:
            - approved
            - gig_id
            - user_id
            - user_instrument_id
          filter:
            _or:
              - user_id:
                  _eq: X-Hasura-User-Id
              - approved:
                  _eq: true
      - role: webmaster
        permission:
          columns:
            - approved
            - gig_id
            - user_id
            - user_instrument_id
          filter: {}
    update_permissions:
      - role: secretary
        permission:
          columns:
            - approved
          filter: {}
      - role: webmaster
        permission:
          columns:
            - approved
          filter: {}
    delete_permissions:
      - role: secretary
        permission:
          filter: {}
      - role: user
        permission:
          filter:
            _and:
              - user_id:
                  _eq: X-Hasura-User-Id
              - approved:
                  _ne: true
      - role: webmaster
        permission:
          filter: {}
  - table:
      schema: cucb
      name: instruments
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - name
            - novelty
            - parent_only
            - parent_id
          filter: {}
      - role: user
        permission:
          columns:
            - novelty
            - parent_only
            - id
            - parent_id
            - name
          filter: {}
      - role: webmaster
        permission:
          columns:
            - id
            - name
            - novelty
            - parent_only
            - parent_id
          filter: {}
  - table:
      schema: cucb
      name: music
  - table:
      schema: cucb
      name: music_types
  - table:
      schema: cucb
      name: news
  - table:
      schema: cucb
      name: photos
  - table:
      schema: cucb
      name: session
  - table:
      schema: cucb
      name: session_tunes
  - table:
      schema: cucb
      name: songs
  - table:
      schema: cucb
      name: user_password_resets
  - table:
      schema: cucb
      name: user_pref_types
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - name
            - default
          filter: {}
      - role: user
        permission:
          columns:
            - default
            - id
            - name
          filter: {}
      - role: webmaster
        permission:
          columns:
            - default
            - id
            - name
          filter: {}
  - table:
      schema: cucb
      name: user_prefs
    object_relationships:
      - name: pref_type
        using:
          foreign_key_constraint_on: pref_id
      - name: user
        using:
          foreign_key_constraint_on: user_id
    select_permissions:
      - role: secretary
        permission:
          columns:
            - user_id
            - pref_id
            - value
          filter: {}
      - role: user
        permission:
          columns:
            - pref_id
            - user_id
            - value
          filter:
            user_id:
              _eq: X-Hasura-User-Id
      - role: webmaster
        permission:
          columns:
            - user_id
            - pref_id
            - value
          filter: {}
  - table:
      schema: cucb
      name: users
    object_relationships:
      - name: admin_type
        using:
          manual_configuration:
            remote_table:
              schema: cucb
              name: auth_user_types
            column_mapping:
              admin: id
    array_relationships:
      - name: calendar_subscriptions
        using:
          foreign_key_constraint_on:
            column: user_id
            table:
              schema: cucb
              name: calendar_subscriptions
      - name: gig_lineups
        using:
          foreign_key_constraint_on:
            column: user_id
            table:
              schema: cucb
              name: gigs_lineups
      - name: prefs
        using:
          foreign_key_constraint_on:
            column: user_id
            table:
              schema: cucb
              name: user_prefs
      - name: user_instruments
        using:
          foreign_key_constraint_on:
            column: user_id
            table:
              schema: cucb
              name: users_instruments
    select_permissions:
      - role: secretary
        permission:
          columns:
            - admin
            - bio
            - bio_changed_date
            - dietaries
            - email
            - first
            - id
            - join_date
            - last
            - last_login_date
            - location_info
            - mobile_contact_info
            - username
          filter: {}
      - role: webmaster
        permission:
          columns:
            - admin
            - bio
            - bio_changed_date
            - dietaries
            - email
            - first
            - id
            - join_date
            - last
            - last_login_date
            - location_info
            - mobile_contact_info
            - username
          filter: {}
  - table:
      schema: cucb
      name: users_instruments
    object_relationships:
      - name: instrument
        using:
          foreign_key_constraint_on: instr_id
      - name: user
        using:
          foreign_key_constraint_on: user_id
    array_relationships:
      - name: connections
        using:
          foreign_key_constraint_on:
            column: user_instrument_id
            table:
              schema: cucb
              name: users_instruments_connections
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - user_id
            - instr_id
            - nickname
            - deleted
          filter: {}
      - role: user
        permission:
          columns:
            - deleted
            - id
            - instr_id
            - user_id
            - nickname
          filter: {}
      - role: webmaster
        permission:
          columns:
            - id
            - user_id
            - instr_id
            - nickname
            - deleted
          filter: {}
  - table:
      schema: cucb
      name: users_instruments_connections
    object_relationships:
      - name: connection_type
        using:
          foreign_key_constraint_on: conn_id
      - name: users_instrument
        using:
          foreign_key_constraint_on: user_instrument_id
    select_permissions:
      - role: secretary
        permission:
          columns:
            - id
            - user_instrument_id
            - conn_id
          filter: {}
      - role: webmaster
        permission:
          columns:
            - id
            - user_instrument_id
            - conn_id
          filter: {}
